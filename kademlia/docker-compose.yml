version: '3'

services:
  root_node:
    image: kademlia-app
    networks:
      kademlia_network:
        ipv4_address: 172.16.238.10  # Static IP for the root node
    ports:
      - "8080:8080"  # Expose root node's port to host for debugging purposes
    environment:
      - ROOT_NODE=TRUE


  kademlia_node:
    image: kademlia-app
    environment:
      - ROOT_ADDRESS=172.16.238.10  # Contact root node via its static IP
    networks:
      - kademlia_network
    depends_on:
      - root_node
    deploy:
      replicas: 4


networks:
  kademlia_network:
    driver: bridge
    ipam:
      config:
        - subnet: 172.16.238.0/24  # Manually configure the subnet for static IPs
